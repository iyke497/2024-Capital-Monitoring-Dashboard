{% extends "layout.html" %}

{% block title %}Eyemark - Compliance Dashboard{% endblock %}
{% block header %}2024 Capital Project Monitoring{% endblock %}

{% block content %}
<div class="controls">
    <div style="display: flex; align-items: center; gap: 15px;">
        <span id="last-updated" style="color: #666; font-size: 14px; font-weight: 500;">
            Last updated: Checking...
        </span>
        <span id="next-update" style="color: #999; font-size: 13px;">
            Next update: Checking...
        </span>
    </div>
    <div id="update-status" style="margin-top: 10px; padding: 8px 12px; background: #f0f0f0; border-radius: 4px; font-size: 13px; display: none;">
        <span id="status-icon">‚è≥</span>
        <span id="status-text">Updating...</span>
    </div>
</div>

<div class="overview-grid">
    <div class="card stats-card">
        <!-- This container should hold BOTH the Total Responses and Response Activity sections -->
        <div class="stats-header">
            <div>
                <h3>Total Responses</h3>
                <div id="total-responses" class="stat-val">0</div>
            </div>
            
            <div class="response-activity-section">
                <div class="activity-header">
                    <h3>Response Activity</h3>
                    <div class="chart-toggle">
                        <button class="timeframe-btn active" data-days="7">7 Days</button>
                        <button class="timeframe-btn" data-days="30">30 Days</button>
                    </div>
                </div>
                <div class="activity-chart-container">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card chart-card">
        <h3>2024 Budget Project Reporting</h3>
        <div class="chart-container">
            <canvas id="budgetChart"></canvas>
        </div>
    </div>
</div>

<div class="card table-card">
    <h3>Ministry Performance & Recent Responses</h3>
    
    <!-- Pills Navigation -->
    <div class="pills-nav">
        <button class="pill-btn active" data-tab="best">Best Performing</button>
        <button class="pill-btn" data-tab="worst">Worst Performing</button>
        <button class="pill-btn" data-tab="recent">Recent Responses</button>
    </div>
    
    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Best Performing Tab -->
        <div id="best-tab" class="tab-pane active">
            <table id="best-ministries-table" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Ministry</th>
                        <th>MDAs</th>
                        <th>Expected</th>
                        <th>Reported</th>
                        <th>Compliance %</th>
                        <th>Performance Score</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Worst Performing Tab -->
        <div id="worst-tab" class="tab-pane">
            <table id="worst-ministries-table" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Ministry</th>
                        <th>MDAs</th>
                        <th>Expected</th>
                        <th>Reported</th>
                        <th>Compliance %</th>
                        <th>Performance Score</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Recent Responses Tab -->
        <div id="recent-tab" class="tab-pane">
            <table id="responses-table" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Project Name</th>
                        <th>ERGP Code</th>
                        <th>MDA</th>
                        <th>% Done</th>
                        <th>Appropriation</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}