<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Dashboard{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="header-bar">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo-link">
                    <img src="{{ url_for('static', filename='images/eyemark-logo.png') }}" alt="Eyemark" class="logo">
                </a>
                <nav>
                    <ul>
                        <li><a href="/compliance">Compliance Metrics</a></li>
                        <li><a href="#" class="export-btn" id="exportDataBtn">Export Data</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>{% block header %}{% endblock %}</h1>
        </header>

        {% block content %}{% endblock %}
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Survey Responses</h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666;">
                    Export survey responses to Excel with optional filters. Leave filters empty to export all data.
                </p>
                
                <form id="exportForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="filter-ministry">Parent Ministry</label>
                            <select id="filter-ministry" name="parent_ministry">
                                <option value="">All Ministries</option>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filter-state">State</label>
                            <select id="filter-state" name="state">
                                <option value="">All States</option>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="filter-status">Project Status</label>
                            <select id="filter-status" name="project_status">
                                <option value="">All Statuses</option>
                                <option value="Not Started">Not Started</option>
                                <option value="Ongoing">Ongoing</option>
                                <option value="Completed">Completed</option>
                                <option value="Suspended">Suspended</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="filter-start-date">Start Date</label>
                            <input type="date" id="filter-start-date" name="start_date">
                        </div>
                        
                        <div class="form-group">
                            <label for="filter-end-date">End Date</label>
                            <input type="date" id="filter-end-date" name="end_date">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="resetFilters">Reset Filters</button>
                        <button type="submit" class="btn btn-primary">
                            <span id="exportBtnText">Export to Excel</span>
                            <span id="exportBtnSpinner" style="display: none;">Exporting...</span>
                        </button>
                    </div>
                </form>
                
                <div id="exportPreview" style="margin-top: 20px; display: none;">
                    <p style="font-size: 14px; color: #666;">
                        <strong>Preview:</strong> <span id="previewCount">0</span> responses will be exported
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!--Export Modal Script-->
    <script src="{{ url_for('static', filename='js/export.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>